# ===========================================================================
# application-test.properties ? CloudApp Integration Test Profile
#
# Place in: backend/cloudapp/src/test/resources/application-test.properties
#
# Activated by @ActiveProfiles("test") in integration tests.
# Points to the ephemeral databases in docker-compose.test.yml.
# ===========================================================================

server.port=8099
server.servlet.context-path=/cloudapp

# --- Postgres (primary) ---
spring.datasource.driver-class-name=org.postgresql.Driver
spring.datasource.url=${SPRING_DATASOURCE_URL:jdbc:postgresql://${DOCKER_HOST_IP:localhost}:15433/cloudappdb_test}
spring.datasource.username=${SPRING_DATASOURCE_USERNAME:testuser}
spring.datasource.password=${SPRING_DATASOURCE_PASSWORD:testpass}
spring.jpa.hibernate.ddl-auto=create-drop
spring.jpa.generate-ddl=true
spring.jpa.properties.hibernate.dialect=org.hibernate.dialect.PostgreSQLDialect
spring.jpa.show-sql=true

# --- MongoDB (chat) ---
spring.data.mongodb.uri=${SPRING_DATA_MONGODB_URI:mongodb://testuser:testpass@${DOCKER_HOST_IP:localhost}:17018/cloudappdb_test?authSource=admin}

# --- Kafka ---
spring.kafka.producer.bootstrap-servers=${SPRING_KAFKA_BOOTSTRAP_SERVERS:${DOCKER_HOST_IP:localhost}:29092}
spring.kafka.consumer.bootstrap-servers=${SPRING_KAFKA_BOOTSTRAP_SERVERS:${DOCKER_HOST_IP:localhost}:29092}
spring.kafka.consumer.auto-offset-reset=earliest
spring.json.trusted.packages=com.example.demo.model.persistence.model

# --- JWT ---
jwt.secret=${JWT_SECRET:test-secret-key-for-integration-tests-only-change-me}
jwt.expiration.ms=${JWT_EXPIRATION_MS:3600000}
jwt.private-key-path=classpath:test-private-key.pem
jwt.public-key-path=classpath:test-public-key.pub
cloudapp.security.admin-usernames=${CLOUDAPP_SECURITY_ADMIN_USERNAMES:integrationadmin}

# --- Internal token ---
internal.service.token=${INTERNAL_SERVICE_TOKEN:test-internal-token}

# --- Actuator ---
management.endpoints.web.exposure.include=health,info
management.endpoint.health.show-details=always
