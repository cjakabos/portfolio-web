/* eslint-disable */
// Generated by scripts/contracts/openapi_contracts.py from contracts/openapi/cloudapp.json
// Source API: Cloudapp API v0.01

import type { RequestQuery, OperationRequestOptions } from './common';

export const CLOUDAPP_OPERATIONS = [
  {
    id: "addToCart",
    method: "POST",
    path: "/cart/addToCart",
    summary: "",
    tags: ["cart-controller"] as const,
    pathParams: [] as const,
    queryParams: [] as const,
    hasRequestBody: true,
    responseStatuses: ["200"] as const,
  },
  {
    id: "clearCart",
    method: "POST",
    path: "/cart/clearCart",
    summary: "",
    tags: ["cart-controller"] as const,
    pathParams: [] as const,
    queryParams: [] as const,
    hasRequestBody: true,
    responseStatuses: ["200"] as const,
  },
  {
    id: "getCart",
    method: "POST",
    path: "/cart/getCart",
    summary: "",
    tags: ["cart-controller"] as const,
    pathParams: [] as const,
    queryParams: [] as const,
    hasRequestBody: true,
    responseStatuses: ["200"] as const,
  },
  {
    id: "removeFromCart",
    method: "POST",
    path: "/cart/removeFromCart",
    summary: "",
    tags: ["cart-controller"] as const,
    pathParams: [] as const,
    queryParams: [] as const,
    hasRequestBody: true,
    responseStatuses: ["200"] as const,
  },
  {
    id: "deleteFile",
    method: "DELETE",
    path: "/file/delete-file/{fileId}",
    summary: "",
    tags: ["file-controller"] as const,
    pathParams: ["fileId"] as const,
    queryParams: [] as const,
    hasRequestBody: false,
    responseStatuses: ["200"] as const,
  },
  {
    id: "getFile",
    method: "GET",
    path: "/file/get-file/{fileId}",
    summary: "",
    tags: ["file-controller"] as const,
    pathParams: ["fileId"] as const,
    queryParams: [] as const,
    hasRequestBody: false,
    responseStatuses: ["200"] as const,
  },
  {
    id: "uploadFile",
    method: "POST",
    path: "/file/upload",
    summary: "",
    tags: ["file-controller"] as const,
    pathParams: [] as const,
    queryParams: ["username"] as const,
    hasRequestBody: true,
    responseStatuses: ["200"] as const,
  },
  {
    id: "getNotes_1",
    method: "GET",
    path: "/file/user/{username}",
    summary: "",
    tags: ["file-controller"] as const,
    pathParams: ["username"] as const,
    queryParams: [] as const,
    hasRequestBody: false,
    responseStatuses: ["200"] as const,
  },
  {
    id: "getItems",
    method: "GET",
    path: "/item",
    summary: "",
    tags: ["item-controller"] as const,
    pathParams: [] as const,
    queryParams: [] as const,
    hasRequestBody: false,
    responseStatuses: ["200"] as const,
  },
  {
    id: "addItem",
    method: "POST",
    path: "/item",
    summary: "",
    tags: ["item-controller"] as const,
    pathParams: [] as const,
    queryParams: [] as const,
    hasRequestBody: true,
    responseStatuses: ["200"] as const,
  },
  {
    id: "getItemsByName",
    method: "GET",
    path: "/item/name/{name}",
    summary: "",
    tags: ["item-controller"] as const,
    pathParams: ["name"] as const,
    queryParams: [] as const,
    hasRequestBody: false,
    responseStatuses: ["200"] as const,
  },
  {
    id: "deleteItem",
    method: "DELETE",
    path: "/item/{id}",
    summary: "",
    tags: ["item-controller"] as const,
    pathParams: ["id"] as const,
    queryParams: [] as const,
    hasRequestBody: false,
    responseStatuses: ["200"] as const,
  },
  {
    id: "getItemById",
    method: "GET",
    path: "/item/{id}",
    summary: "",
    tags: ["item-controller"] as const,
    pathParams: ["id"] as const,
    queryParams: [] as const,
    hasRequestBody: false,
    responseStatuses: ["200"] as const,
  },
  {
    id: "updateItem",
    method: "PUT",
    path: "/item/{id}",
    summary: "",
    tags: ["item-controller"] as const,
    pathParams: ["id"] as const,
    queryParams: [] as const,
    hasRequestBody: true,
    responseStatuses: ["200"] as const,
  },
  {
    id: "insertOrUpdateNote_1",
    method: "POST",
    path: "/note/addNote",
    summary: "",
    tags: ["note-controller"] as const,
    pathParams: [] as const,
    queryParams: [] as const,
    hasRequestBody: true,
    responseStatuses: ["200"] as const,
  },
  {
    id: "deleteNote",
    method: "DELETE",
    path: "/note/delete/{id}",
    summary: "",
    tags: ["note-controller"] as const,
    pathParams: ["id"] as const,
    queryParams: [] as const,
    hasRequestBody: false,
    responseStatuses: ["200"] as const,
  },
  {
    id: "insertOrUpdateNote",
    method: "POST",
    path: "/note/updateNote",
    summary: "",
    tags: ["note-controller"] as const,
    pathParams: [] as const,
    queryParams: [] as const,
    hasRequestBody: true,
    responseStatuses: ["200"] as const,
  },
  {
    id: "getNotes",
    method: "GET",
    path: "/note/user/{username}",
    summary: "",
    tags: ["note-controller"] as const,
    pathParams: ["username"] as const,
    queryParams: [] as const,
    hasRequestBody: false,
    responseStatuses: ["200"] as const,
  },
  {
    id: "getOrdersForUser",
    method: "GET",
    path: "/order/history/{username}",
    summary: "",
    tags: ["order-controller"] as const,
    pathParams: ["username"] as const,
    queryParams: [] as const,
    hasRequestBody: false,
    responseStatuses: ["200"] as const,
  },
  {
    id: "submit",
    method: "POST",
    path: "/order/submit/{username}",
    summary: "",
    tags: ["order-controller"] as const,
    pathParams: ["username"] as const,
    queryParams: [] as const,
    hasRequestBody: false,
    responseStatuses: ["200"] as const,
  },
  {
    id: "findRoomByUsername",
    method: "GET",
    path: "/room",
    summary: "",
    tags: ["room-controller"] as const,
    pathParams: [] as const,
    queryParams: [] as const,
    hasRequestBody: false,
    responseStatuses: ["200"] as const,
  },
  {
    id: "create",
    method: "POST",
    path: "/room",
    summary: "",
    tags: ["room-controller"] as const,
    pathParams: [] as const,
    queryParams: [] as const,
    hasRequestBody: true,
    responseStatuses: ["200"] as const,
  },
  {
    id: "find",
    method: "GET",
    path: "/room/{code}",
    summary: "",
    tags: ["room-controller"] as const,
    pathParams: ["code"] as const,
    queryParams: [] as const,
    hasRequestBody: false,
    responseStatuses: ["200"] as const,
  },
  {
    id: "updateUserRoles",
    method: "POST",
    path: "/user/admin/roles",
    summary: "",
    tags: ["user-controller"] as const,
    pathParams: [] as const,
    queryParams: [] as const,
    hasRequestBody: true,
    responseStatuses: ["200"] as const,
  },
  {
    id: "listUsernames",
    method: "GET",
    path: "/user/admin/users",
    summary: "",
    tags: ["user-controller"] as const,
    pathParams: [] as const,
    queryParams: [] as const,
    hasRequestBody: false,
    responseStatuses: ["200"] as const,
  },
  {
    id: "authCheck",
    method: "GET",
    path: "/user/auth-check",
    summary: "",
    tags: ["user-controller"] as const,
    pathParams: [] as const,
    queryParams: [] as const,
    hasRequestBody: false,
    responseStatuses: ["200"] as const,
  },
  {
    id: "getCsrfToken",
    method: "GET",
    path: "/user/csrf-token",
    summary: "",
    tags: ["user-controller"] as const,
    pathParams: [] as const,
    queryParams: ["csrfToken"] as const,
    hasRequestBody: false,
    responseStatuses: ["200"] as const,
  },
  {
    id: "findById",
    method: "GET",
    path: "/user/id/{id}",
    summary: "",
    tags: ["user-controller"] as const,
    pathParams: ["id"] as const,
    queryParams: [] as const,
    hasRequestBody: false,
    responseStatuses: ["200"] as const,
  },
  {
    id: "changePassword",
    method: "POST",
    path: "/user/user-change-password",
    summary: "",
    tags: ["user-controller"] as const,
    pathParams: [] as const,
    queryParams: [] as const,
    hasRequestBody: true,
    responseStatuses: ["200"] as const,
  },
  {
    id: "authenticateUser",
    method: "POST",
    path: "/user/user-login",
    summary: "",
    tags: ["user-controller"] as const,
    pathParams: [] as const,
    queryParams: [] as const,
    hasRequestBody: true,
    responseStatuses: ["200"] as const,
  },
  {
    id: "logoutUser",
    method: "POST",
    path: "/user/user-logout",
    summary: "",
    tags: ["user-controller"] as const,
    pathParams: [] as const,
    queryParams: [] as const,
    hasRequestBody: false,
    responseStatuses: ["200"] as const,
  },
  {
    id: "createUser",
    method: "POST",
    path: "/user/user-register",
    summary: "",
    tags: ["user-controller"] as const,
    pathParams: [] as const,
    queryParams: [] as const,
    hasRequestBody: true,
    responseStatuses: ["200"] as const,
  },
  {
    id: "findByUserName",
    method: "GET",
    path: "/user/{username}",
    summary: "",
    tags: ["user-controller"] as const,
    pathParams: ["username"] as const,
    queryParams: [] as const,
    hasRequestBody: false,
    responseStatuses: ["200"] as const,
  },
] as const;

export type CloudappOperation = typeof CLOUDAPP_OPERATIONS[number];
export type CloudappOperationId = CloudappOperation["id"];
export type CloudappOperationMethod = CloudappOperation["method"];
export type CloudappOperationPath = CloudappOperation["path"];

export const cloudappOperationById: Record<CloudappOperationId, CloudappOperation> =
  Object.fromEntries(CLOUDAPP_OPERATIONS.map((op) => [op.id, op])) as Record<CloudappOperationId, CloudappOperation>;

export interface CloudappClientConfig {
  baseUrl: string;
  defaultHeaders?: HeadersInit;
  defaultCredentials?: RequestCredentials;
  fetchImpl?: typeof fetch;
}

function buildUrl(pathTemplate: string, baseUrl: string, pathParams: Record<string, string | number> = {}, query?: RequestQuery) {
  const substituted = pathTemplate.replace(/{([^}/]+)}/g, (_, key: string) => {
    const value = pathParams[key];
    if (value === undefined || value === null) {
      throw new Error(`Missing path param: ${key}`);
    }
    return encodeURIComponent(String(value));
  });

  const url = new URL(substituted, baseUrl.endsWith("/") ? baseUrl : `${baseUrl}/`);
  if (query) {
    for (const [key, raw] of Object.entries(query)) {
      if (raw === undefined || raw === null) continue;
      if (Array.isArray(raw)) {
        for (const value of raw) {
          if (value === undefined || value === null) continue;
          url.searchParams.append(key, String(value));
        }
      } else {
        url.searchParams.set(key, String(raw));
      }
    }
  }
  return url.toString();
}

export class CloudappApiClient {
  private readonly baseUrl: string;
  private readonly defaultHeaders?: HeadersInit;
  private readonly defaultCredentials?: RequestCredentials;
  private readonly fetchImpl: typeof fetch;

  constructor(config: CloudappClientConfig) {
    this.baseUrl = config.baseUrl;
    this.defaultHeaders = config.defaultHeaders;
    this.defaultCredentials = config.defaultCredentials;
    this.fetchImpl = config.fetchImpl ?? fetch;
  }

  async request<T = unknown>(operationId: CloudappOperationId, options: OperationRequestOptions = {}): Promise<T> {
    const op = cloudappOperationById[operationId];
    const url = buildUrl(op.path, this.baseUrl, options.pathParams, options.query);
    const headers = new Headers(this.defaultHeaders);
    if (options.headers) {
      new Headers(options.headers).forEach((value, key) => headers.set(key, value));
    }
    let body: BodyInit | undefined;
    if (options.body !== undefined) {
      if (!headers.has("Content-Type")) {
        headers.set("Content-Type", "application/json");
      }
      body = headers.get("Content-Type")?.includes("application/json")
        ? JSON.stringify(options.body)
        : (options.body as BodyInit);
    }

    const response = await this.fetchImpl(url, {
      method: op.method,
      headers,
      body,
      credentials: options.credentials ?? this.defaultCredentials,
      signal: options.signal,
    });

    if (!response.ok) {
      const text = await response.text().catch(() => "");
      throw new Error(`API request failed (${op.method} ${op.path}): ${response.status} ${text}`);
    }

    if (response.status === 204) {
      return undefined as T;
    }
    return (await response.json()) as T;
  }
}
