# ==========================================================================
# security-headers.conf — Browser security baseline
#
# Included at the server level (for locations with no add_header of their
# own) and explicitly inside every API location block in locations.conf
# (because NGINX's add_header at location level replaces server-level ones).
# ==========================================================================

# Hide any backend-provided security headers so the gateway stays the single
# source of truth for browser-facing policy values.
proxy_hide_header X-Content-Type-Options;
proxy_hide_header X-Frame-Options;
proxy_hide_header Referrer-Policy;
proxy_hide_header Strict-Transport-Security;
proxy_hide_header Content-Security-Policy;

add_header X-Content-Type-Options  "nosniff" always;
add_header X-Frame-Options         "SAMEORIGIN" always;
add_header Referrer-Policy         "strict-origin-when-cross-origin" always;

# HSTS — 1 day for dev; set max-age=63072000 (2 years) for production.
add_header Strict-Transport-Security "max-age=86400" always;

# CSP — permissive baseline that works with Next.js SSR, Swagger UI, and
# WebSocket connections.  Tighten for production (nonces, drop unsafe-eval).
add_header Content-Security-Policy "default-src 'self'; script-src 'self' 'unsafe-inline' 'unsafe-eval'; style-src 'self' 'unsafe-inline'; img-src 'self' data: blob:; font-src 'self' data:; connect-src 'self' ws: wss:; frame-src 'self'; object-src 'none'; base-uri 'self'; form-action 'self'" always;
